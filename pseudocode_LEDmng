# Vulnerable road user assistance:
def vulnerable_user_assistance():
    cycle_duration = 10
    # Da sistemare per far capire da che bottone arriva il comando (per capire a che direzione allungare il tempo)
    mqtt.publish("semaforo","NSoff-EOoff")
    mqtt.publish("trafficlightviolation","NSoff-EOoff")
    time.sleep(cycle_duration)
    mqtt.publish("semaforo","NSon-EOoff")
    mqtt.publish("trafficlightviolation","NSoff-EOoff")
    time.sleep(cycle_duration)  
    
def default_traffic_light():
    cycle_duration = 5
    mqtt.publish("semaforo","NSon-EOoff")
    mqtt.publish("trafficlightviolation","NSoff-EOoff")
    time.sleep(cycle_duration)
    mqtt.publish("semaforo","NSoff-EOon")
    mqtt.publish("trafficlightviolation","NSoff-EOoff")
    time.sleep(cycle_duration)

def pedestrian_cycle():
    cycle_duration = 7
    mqtt.publish("semaforo","NSoff-EOoff")
    mqtt.publish("trafficlightviolation","NSoff-EOoff")
    time.sleep(cycle_duration)
    mqtt.publish("semaforo","NSon-EOoff")
    mqtt.publish("trafficlightviolation","NSoff-EOoff")
    time.sleep(cycle_duration)  

def emergency_traffic_light():
    mqtt.retrieve("direction")
    # vai a attuare i semafori in base alla direzione ricevuta in modo tale da
    # garantire onda verde al veicolo in arrivo (per tipo 20s)
    
while True:
    # Le funzioni devono funzionare solo a partire dal ciclo semaforico successivo (es. se è verde e pedone viene rilevato 
    # o bottone premuto, la funzione deve partire dal ciclo successivo). A parte emergency che deve far diventare verde da poco dopo
    # quando viene ricevuto il messaggio e lasciare verde per 20s
    if emergency():
        emergency_traffic_light() # immaginamo che l'emergency service operation center mandi un messaggio
        # contenente l'alert e la direzione in cui transiterà il mezzo di soccorso e lo passiamo alla funzione
        # che crea un'onda verde di conseguenza.
    if button.pressed():
        vulnerable_user_assistance() # Se il bottone viene premuto diamo il tempo massimo di cross (10s)
    if pedestrian.detected():
        pedestrian_cycle    # Se pedone viene rilevato, aumentiamo un tot il tempo di percorrenza (7s)
    else:
        default_traffic_light()